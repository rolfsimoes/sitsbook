<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Working with time series | sits: Data Analysis and Machine Learning on Earth Observation Data Cubes with Satellite Image Time Series</title>
  <meta name="description" content="This book presents sits, an open-source R package for satellite image time series analysis. The package supports the application of machine learning techniques for classification image time series obtained from data cubes." />
  <meta name="generator" content="bookdown 0.21.4 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Working with time series | sits: Data Analysis and Machine Learning on Earth Observation Data Cubes with Satellite Image Time Series" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/cover.png" />
  <meta property="og:description" content="This book presents sits, an open-source R package for satellite image time series analysis. The package supports the application of machine learning techniques for classification image time series obtained from data cubes." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Working with time series | sits: Data Analysis and Machine Learning on Earth Observation Data Cubes with Satellite Image Time Series" />
  
  <meta name="twitter:description" content="This book presents sits, an open-source R package for satellite image time series analysis. The package supports the application of machine learning techniques for classification image time series obtained from data cubes." />
  <meta name="twitter:image" content="/images/cover.png" />

<meta name="author" content="Rolf Simoes" />
<meta name="author" content="Gilberto Camara" />
<meta name="author" content="Felipe Souza" />
<meta name="author" content="Lorena Santos" />
<meta name="author" content="Pedro R. Andrade" />
<meta name="author" content="Alexandre Carvalho" />
<meta name="author" content="Karine Ferreira" />
<meta name="author" content="Gilberto Queiroz" />
<meta name="author" content="Victor Maus" />


<meta name="date" content="2021-04-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="earth-observation-data-cubes.html"/>
<link rel="next" href="time-series-clustering-to-improve-the-quality-of-training-samples.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SITS Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#publications-using-sits"><i class="fa fa-check"></i>Publications using sits</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducible-papers-used-in-building-sits-functions"><i class="fa fa-check"></i>Reproducible papers used in building sits functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Setup</a><ul>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#docker-images"><i class="fa fa-check"></i>Docker images</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="part"><span><b>I Overview</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#workflow-and-api"><i class="fa fa-check"></i><b>1.1</b> Workflow and API</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#handling-data-cubes-in-sits"><i class="fa fa-check"></i><b>1.2</b> Handling Data Cubes in sits</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#handling-satellite-image-time-series-in-sits"><i class="fa fa-check"></i><b>1.3</b> Handling satellite image time series in <strong>sits</strong></a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#data-structure"><i class="fa fa-check"></i><b>1.3.1</b> Data structure</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#obtaining-time-series-data"><i class="fa fa-check"></i><b>1.3.2</b> Obtaining time series data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#sample-quality-control-using-clustering"><i class="fa fa-check"></i><b>1.4</b> Sample quality control using clustering</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#classification-using-machine-learning"><i class="fa fa-check"></i><b>1.5</b> Classification using machine learning</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#cube-classification"><i class="fa fa-check"></i><b>1.6</b> Cube classification</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#smoothing-and-labelling-of-raster-data-after-classification"><i class="fa fa-check"></i><b>1.7</b> Smoothing and Labelling of raster data after classification</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#validation-techniques"><i class="fa fa-check"></i><b>1.8</b> Validation techniques</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#final-remarks"><i class="fa fa-check"></i><b>1.9</b> Final remarks</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html"><i class="fa fa-check"></i><b>2</b> Earth observation data cubes</a><ul>
<li class="chapter" data-level="2.1" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#image-data-cubes-as-the-basis-for-big-earth-observation-data-analysis"><i class="fa fa-check"></i><b>2.1</b> Image data cubes as the basis for big Earth observation data analysis</a></li>
<li class="chapter" data-level="2.2" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#accessing-data-cubes-and-image-collections-in-sits"><i class="fa fa-check"></i><b>2.2</b> Accessing Data Cubes and Image Collections in SITS</a><ul>
<li class="chapter" data-level="2.2.1" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#accessing-data-cubes-in-amazon-web-services"><i class="fa fa-check"></i><b>2.2.1</b> Accessing data cubes in Amazon Web Services</a></li>
<li class="chapter" data-level="2.2.2" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#accessing-the-brazil-data-cube"><i class="fa fa-check"></i><b>2.2.2</b> Accessing the Brazil Data Cube</a></li>
<li class="chapter" data-level="2.2.3" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#defining-a-data-cube-using-files"><i class="fa fa-check"></i><b>2.2.3</b> Defining a data cube using files</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="earth-observation-data-cubes.html"><a href="earth-observation-data-cubes.html#regularizing-data-cubes"><i class="fa fa-check"></i><b>2.3</b> Regularizing data cubes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-time-series.html"><a href="working-with-time-series.html"><i class="fa fa-check"></i><b>3</b> Working with time series</a><ul>
<li class="chapter" data-level="3.1" data-path="working-with-time-series.html"><a href="working-with-time-series.html#data-structures-for-satellite-time-series"><i class="fa fa-check"></i><b>3.1</b> Data structures for satellite time series</a></li>
<li class="chapter" data-level="3.2" data-path="working-with-time-series.html"><a href="working-with-time-series.html#utilities-for-handling-time-series"><i class="fa fa-check"></i><b>3.2</b> Utilities for handling time series</a></li>
<li class="chapter" data-level="3.3" data-path="working-with-time-series.html"><a href="working-with-time-series.html#time-series-visualisation"><i class="fa fa-check"></i><b>3.3</b> Time series visualisation</a></li>
<li class="chapter" data-level="3.4" data-path="working-with-time-series.html"><a href="working-with-time-series.html#obtaining-time-series-data-from-data-cubes"><i class="fa fa-check"></i><b>3.4</b> Obtaining time series data from data cubes</a></li>
<li class="chapter" data-level="3.5" data-path="working-with-time-series.html"><a href="working-with-time-series.html#filtering-techniques-for-time-series"><i class="fa fa-check"></i><b>3.5</b> Filtering techniques for time series</a><ul>
<li class="chapter" data-level="3.5.1" data-path="working-with-time-series.html"><a href="working-with-time-series.html#savitzkygolay-filter"><i class="fa fa-check"></i><b>3.5.1</b> Savitzky–Golay filter</a></li>
<li class="chapter" data-level="3.5.2" data-path="working-with-time-series.html"><a href="working-with-time-series.html#whittaker-filter"><i class="fa fa-check"></i><b>3.5.2</b> Whittaker filter</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Clustering</b></span></li>
<li class="chapter" data-level="4" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html"><i class="fa fa-check"></i><b>4</b> Time Series Clustering to Improve the Quality of Training Samples</a><ul>
<li class="chapter" data-level="4.1" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#clustering-for-sample-quality-control"><i class="fa fa-check"></i><b>4.1</b> Clustering for sample quality control</a></li>
<li class="chapter" data-level="4.2" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#hierachical-clustering-for-sample-quality-control"><i class="fa fa-check"></i><b>4.2</b> Hierachical clustering for Sample Quality Control</a><ul>
<li class="chapter" data-level="4.2.1" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#creating-a-dendogram"><i class="fa fa-check"></i><b>4.2.1</b> Creating a dendogram</a></li>
<li class="chapter" data-level="4.2.2" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#using-a-dendrogram-to-evaluate-sample-quality"><i class="fa fa-check"></i><b>4.2.2</b> Using a dendrogram to evaluate sample quality</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#using-self-organizing-maps-for-sample-quality"><i class="fa fa-check"></i><b>4.3</b> Using Self-organizing Maps for Sample Quality</a><ul>
<li class="chapter" data-level="4.3.1" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#introduction-to-self-organizing-maps"><i class="fa fa-check"></i><b>4.3.1</b> Introduction to Self-organizing Maps</a></li>
<li class="chapter" data-level="4.3.2" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#using-som-for-removing-class-noise"><i class="fa fa-check"></i><b>4.3.2</b> Using SOM for removing class noise</a></li>
<li class="chapter" data-level="4.3.3" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#comparing-global-accuracy-of-original-and-clean-samples"><i class="fa fa-check"></i><b>4.3.3</b> Comparing Global Accuracy of Original and Clean Samples</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="time-series-clustering-to-improve-the-quality-of-training-samples.html"><a href="time-series-clustering-to-improve-the-quality-of-training-samples.html#conclusion"><i class="fa fa-check"></i><b>4.4</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>III Classification</b></span></li>
<li class="chapter" data-level="5" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html"><i class="fa fa-check"></i><b>5</b> Machine Learning for Data Cubes using the SITS package</a><ul>
<li class="chapter" data-level="5.1" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#machine-learning-classification"><i class="fa fa-check"></i><b>5.1</b> Machine learning classification</a></li>
<li class="chapter" data-level="5.2" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#visualizing-samples"><i class="fa fa-check"></i><b>5.2</b> Visualizing Samples</a></li>
<li class="chapter" data-level="5.3" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#common-interface-to-machine-learning-and-deeplearning-models"><i class="fa fa-check"></i><b>5.3</b> Common interface to machine learning and deeplearning models</a></li>
<li class="chapter" data-level="5.4" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#random-forests"><i class="fa fa-check"></i><b>5.4</b> Random forests</a></li>
<li class="chapter" data-level="5.5" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#support-vector-machines"><i class="fa fa-check"></i><b>5.5</b> Support Vector Machines</a></li>
<li class="chapter" data-level="5.6" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#extreme-gradient-boosting"><i class="fa fa-check"></i><b>5.6</b> Extreme Gradient Boosting</a></li>
<li class="chapter" data-level="5.7" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#deep-learning-using-multi-layer-perceptrons"><i class="fa fa-check"></i><b>5.7</b> Deep learning using multi-layer perceptrons</a></li>
<li class="chapter" data-level="5.8" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#combined-1d-cnn-and-multi-layer-perceptron-networks"><i class="fa fa-check"></i><b>5.8</b> Combined 1D CNN and multi-layer perceptron networks</a></li>
<li class="chapter" data-level="5.9" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#d-convolutional-neural-networks"><i class="fa fa-check"></i><b>5.9</b> 1D Convolutional Neural Networks</a></li>
<li class="chapter" data-level="5.10" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#residual-1d-cnn-networks-resnet"><i class="fa fa-check"></i><b>5.10</b> Residual 1D CNN Networks (ResNet)</a></li>
<li class="chapter" data-level="5.11" data-path="machine-learning-for-data-cubes-using-the-sits-package.html"><a href="machine-learning-for-data-cubes-using-the-sits-package.html#lstm-convolutional-networks-for-time-series-classification"><i class="fa fa-check"></i><b>5.11</b> LSTM Convolutional Networks for Time Series Classification</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="classification-of-images-in-data-cubes-using-satellite-image-time-series.html"><a href="classification-of-images-in-data-cubes-using-satellite-image-time-series.html"><i class="fa fa-check"></i><b>6</b> Classification of Images in Data Cubes using Satellite Image Time Series</a><ul>
<li class="chapter" data-level="6.1" data-path="classification-of-images-in-data-cubes-using-satellite-image-time-series.html"><a href="classification-of-images-in-data-cubes-using-satellite-image-time-series.html#data-cube-classification"><i class="fa fa-check"></i><b>6.1</b> Data cube classification</a></li>
<li class="chapter" data-level="6.2" data-path="classification-of-images-in-data-cubes-using-satellite-image-time-series.html"><a href="classification-of-images-in-data-cubes-using-satellite-image-time-series.html#adjustments-for-improved-performance"><i class="fa fa-check"></i><b>6.2</b> Adjustments for improved performance</a></li>
<li class="chapter" data-level="6.3" data-path="classification-of-images-in-data-cubes-using-satellite-image-time-series.html"><a href="classification-of-images-in-data-cubes-using-satellite-image-time-series.html#final-remarks-1"><i class="fa fa-check"></i><b>6.3</b> Final remarks</a></li>
</ul></li>
<li class="part"><span><b>IV Post classification</b></span></li>
<li class="chapter" data-level="7" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html"><i class="fa fa-check"></i><b>7</b> Post classification smoothing</a><ul>
<li class="chapter" data-level="7.1" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html#bayesian-smoothing"><i class="fa fa-check"></i><b>7.2</b> Bayesian smoothing</a><ul>
<li class="chapter" data-level="7.2.1" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html#derivation-of-bayesian-parameters-for-spatiotemporal-smoothing"><i class="fa fa-check"></i><b>7.2.1</b> Derivation of bayesian parameters for spatiotemporal smoothing</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html#use-of-bayesian-smoothing-in-sits"><i class="fa fa-check"></i><b>7.3</b> Use of Bayesian smoothing in SITS</a></li>
<li class="chapter" data-level="7.4" data-path="post-classification-smoothing.html"><a href="post-classification-smoothing.html#bilateral-smoothing"><i class="fa fa-check"></i><b>7.4</b> Bilateral smoothing</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html"><i class="fa fa-check"></i><b>8</b> Validation and accuracy measurements in SITS</a><ul>
<li class="chapter" data-level="8.1" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html#validation-techniques-1"><i class="fa fa-check"></i><b>8.1</b> Validation techniques</a></li>
<li class="chapter" data-level="8.2" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html#comparing-different-machine-learning-methods-using-k-fold-validation"><i class="fa fa-check"></i><b>8.2</b> Comparing different machine learning methods using k-fold validation</a></li>
<li class="chapter" data-level="8.3" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html#accuracy-assessment"><i class="fa fa-check"></i><b>8.3</b> Accuracy assessment</a><ul>
<li class="chapter" data-level="8.3.1" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html#time-series"><i class="fa fa-check"></i><b>8.3.1</b> Time series</a></li>
<li class="chapter" data-level="8.3.2" data-path="validation-and-accuracy-measurements-in-sits.html"><a href="validation-and-accuracy-measurements-in-sits.html#classified-images"><i class="fa fa-check"></i><b>8.3.2</b> Classified images</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><strong>sits</strong>: Data Analysis and Machine Learning on Earth Observation Data Cubes with Satellite Image Time Series</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-time-series" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Working with time series</h1>
<hr />
<p>This chapter describes how to access information from time series in SITS.</p>
<hr />
<div id="data-structures-for-satellite-time-series" class="section level2">
<h2><span class="header-section-number">3.1</span> Data structures for satellite time series</h2>
<p>The <em>sits</em> package requires a set of time series data, describing properties in spatiotemporal locations of interest. For land use classification, this set consists of samples provided by experts that take in-situ field observations or recognize land classes using high-resolution images. The package can also be used for any type of classification, provided that the timeline and bands of the time series (used for training) match that of the data cubes.</p>
<p>For handling time series, the package uses a <code>sits tibble</code> to organize time series data with associated spatial information. A <code>tibble</code> is a generalization of a <code>data.frame</code>, the usual way in R to organize data in tables. Tibbles are part of the <code>tidyverse</code>, a collection of R packages designed to work together in data manipulation <span class="citation">(Wickham and Grolemund 2017)</span>. As an example of how the sits tibble works, the following code shows the first three lines of a tibble containing <span class="math inline">\(1,882\)</span> labeled samples of land cover in Mato Grosso state of Brazil. The samples contain time series extracted from the MODIS MOD13Q1 product from 2000 to 2016, provided every <span class="math inline">\(16\)</span> days at <span class="math inline">\(250\)</span>-meter spatial resolution in the Sinusoidal projection. Based on ground surveys and high-resolution imagery, it includes samples of nine classes: “Forest”, “Cerrado”, “Pasture”, “Soybean-fallow”, “Fallow-Cotton”, “Soybean-Cotton”, “Soybean-Corn”, “Soybean-Millet”, and “Soybean-Sunflower”.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="working-with-time-series.html#cb22-1"></a><span class="co"># data set of samples</span></span>
<span id="cb22-2"><a href="working-with-time-series.html#cb22-2"></a><span class="kw">data</span>(<span class="st">&quot;samples_matogrosso_mod13q1&quot;</span>)</span>
<span id="cb22-3"><a href="working-with-time-series.html#cb22-3"></a>samples_matogrosso_mod13q1[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre class="sourceCode"><code>#&gt; # A tibble: 3 x 7
#&gt;   longitude latitude start_date end_date   label   cube    time_series      
#&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;list&gt;           
#&gt; 1     -55.2   -10.8  2013-09-14 2014-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 2     -57.8    -9.76 2006-09-14 2007-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 3     -51.9   -13.4  2014-09-14 2015-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;</code></pre>
<p>A sits tibble contains data and metadata. The first six columns contain the metadata: spatial and temporal information, the label assigned to the sample, and the data cube from where the data has been extracted. The spatial location is given in longitude and latitude coordinates for the “WGS84” ellipsoid. For example, the first sample has been labeled "Cerrado, at location (-58.5631, -13.8844) and is considered valid for the period (2007-09-14, 2008-08-28). Informing the dates where the label is valid is crucial for correct classification. In this case, the researchers involved in labeling the samples chose to use the agricultural calendar in Brazil, where the spring crop is planted in the months of September and October, and the autumn crop is planted in the months of February and March. For other applications and other countries, the relevant dates will most likely be different from those used in the example. The <code>time_series</code> column contains the time series data for each spatiotemporal location. This data is also organized as a tibble, with a column with the dates and the other columns with the values for each spectral band.</p>
</div>
<div id="utilities-for-handling-time-series" class="section level2">
<h2><span class="header-section-number">3.2</span> Utilities for handling time series</h2>
<p>The package provides functions for data manipulation and displaying information for sits tibble. For example, <code>sits_labels_summary()</code> shows the labels of the sample set and their frequencies.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="working-with-time-series.html#cb24-1"></a><span class="kw">sits_labels_summary</span>(samples_matogrosso_mod13q1)</span></code></pre></div>
<pre class="sourceCode"><code>#&gt; # A tibble: 9 x 3
#&gt;   label         count   prop
#&gt;   &lt;chr&gt;         &lt;int&gt;  &lt;dbl&gt;
#&gt; 1 Cerrado         379 0.200 
#&gt; 2 Fallow_Cotton    29 0.0153
#&gt; 3 Forest          131 0.0692
#&gt; 4 Pasture         344 0.182 
#&gt; 5 Soy_Corn        364 0.192 
#&gt; 6 Soy_Cotton      352 0.186 
#&gt; 7 Soy_Fallow       87 0.0460
#&gt; 8 Soy_Millet      180 0.0951
#&gt; 9 Soy_Sunflower    26 0.0137</code></pre>
<p>In many cases, it is helpful to relabel the data set. For example, there may be situations when one wants to use a smaller set of labels, since samples in one label on the original set may not be distinguishable from samples with other labels. We then could use <code>sits_relabel()</code>, which requires a conversion list (for details, see <code>?sits_relabel</code>).</p>
<p>Given that we have used the tibble data format for the metadata and the embedded time series, one can use the functions from <code>dplyr</code>, <code>tidyr</code>, and <code>purrr</code> packages of the <code>tidyverse</code> <span class="citation">(Wickham and Grolemund 2017)</span> to process the data. For example, the following code uses <code>sits_select()</code> to get a subset of the sample data set with two bands (NDVI and EVI) and then uses the <code>dplyr::filter()</code> to select the samples labelled either as “Cerrado” or “Pasture”.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="working-with-time-series.html#cb26-1"></a><span class="co"># select NDVI band</span></span>
<span id="cb26-2"><a href="working-with-time-series.html#cb26-2"></a>samples_ndvi &lt;-<span class="st"> </span><span class="kw">sits_select</span>(samples_matogrosso_mod13q1, </span>
<span id="cb26-3"><a href="working-with-time-series.html#cb26-3"></a>                            <span class="dt">bands =</span> <span class="st">&quot;NDVI&quot;</span>)</span>
<span id="cb26-4"><a href="working-with-time-series.html#cb26-4"></a></span>
<span id="cb26-5"><a href="working-with-time-series.html#cb26-5"></a><span class="co"># select only samples with Cerrado label</span></span>
<span id="cb26-6"><a href="working-with-time-series.html#cb26-6"></a>samples_cerrado &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(samples_ndvi, label <span class="op">==</span><span class="st"> &quot;Cerrado&quot;</span>)</span></code></pre></div>
</div>
<div id="time-series-visualisation" class="section level2">
<h2><span class="header-section-number">3.3</span> Time series visualisation</h2>
<p>Given a small number of samples to display, <code>plot</code> tries to group as many spatial locations together. In the following example, the first 12 samples of “Cerrado” class refer to the same spatial location in consecutive time periods. For this reason, these samples are plotted together.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="working-with-time-series.html#cb27-1"></a><span class="co"># plot the first 12 samples</span></span>
<span id="cb27-2"><a href="working-with-time-series.html#cb27-2"></a><span class="kw">plot</span>(samples_cerrado[<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>,])</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cerrado-12"></span>
<img src="sitsbook_files/figure-html/cerrado-12-1.png" alt="Plot of the first 'Cerrado' sample from data set" width="70%" />
<p class="caption">
Figure 3.1: Plot of the first ‘Cerrado’ sample from data set
</p>
</div>
<p>For a large number of samples, where the number of individual plots would be substantial, the default visualization combines all samples together in a single temporal interval (even if they belong to different years). All samples with the same band and label are aligned to a common time interval. This plot is useful to show the spread of values for the time series of each band. The strong red line in the plot shows the median of the values, while the two orange lines are the first and third interquartile ranges. The documentation of <code>plot.sits()</code> has more details about the different ways it can display data.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="working-with-time-series.html#cb28-1"></a><span class="co"># plot all cerrado samples together</span></span>
<span id="cb28-2"><a href="working-with-time-series.html#cb28-2"></a><span class="kw">plot</span>(samples_cerrado)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-27"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-27-1.png" alt="Plot of all Cerrado samples from data set" width="70%" />
<p class="caption">
Figure 3.2: Plot of all Cerrado samples from data set
</p>
</div>
</div>
<div id="obtaining-time-series-data-from-data-cubes" class="section level2">
<h2><span class="header-section-number">3.4</span> Obtaining time series data from data cubes</h2>
<p>To get a time series in sits, one has to create a data cube, as described previously. Users can request one or more time series points from a data cube by using <code>sits_get_data()</code>. This function provides a general means of access to image time series. Given a data cube, the user provides the latitude and longitude of the desired location, the bands, and the start date and end date of the time series. If the start and end dates are not provided, it retrieves all the available periods. The result is a tibble that can be visualized using <code>plot()</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="working-with-time-series.html#cb29-1"></a><span class="co"># Obtain a raster cube with 23 instances for one year</span></span>
<span id="cb29-2"><a href="working-with-time-series.html#cb29-2"></a><span class="co"># Select the band &quot;ndvi&quot;, &quot;evi&quot; from images available in the &quot;sitsdata&quot; package</span></span>
<span id="cb29-3"><a href="working-with-time-series.html#cb29-3"></a>data_dir &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/sinop&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;sitsdata&quot;</span>)</span>
<span id="cb29-4"><a href="working-with-time-series.html#cb29-4"></a></span>
<span id="cb29-5"><a href="working-with-time-series.html#cb29-5"></a><span class="co"># create a raster metadata file based on the information about the files</span></span>
<span id="cb29-6"><a href="working-with-time-series.html#cb29-6"></a>raster_cube &lt;-<span class="st"> </span><span class="kw">sits_cube</span>(</span>
<span id="cb29-7"><a href="working-with-time-series.html#cb29-7"></a>    <span class="dt">source     =</span> <span class="st">&quot;LOCAL&quot;</span>,</span>
<span id="cb29-8"><a href="working-with-time-series.html#cb29-8"></a>    <span class="dt">satellite  =</span> <span class="st">&quot;TERRA&quot;</span>,</span>
<span id="cb29-9"><a href="working-with-time-series.html#cb29-9"></a>    <span class="dt">sensor     =</span> <span class="st">&quot;MODIS&quot;</span>,</span>
<span id="cb29-10"><a href="working-with-time-series.html#cb29-10"></a>    <span class="dt">name       =</span> <span class="st">&quot;Sinop&quot;</span>,</span>
<span id="cb29-11"><a href="working-with-time-series.html#cb29-11"></a>    <span class="dt">data_dir   =</span> data_dir,</span>
<span id="cb29-12"><a href="working-with-time-series.html#cb29-12"></a>    <span class="dt">parse_info =</span> <span class="kw">c</span>(<span class="st">&quot;X1&quot;</span>, <span class="st">&quot;X2&quot;</span>, <span class="st">&quot;band&quot;</span>, <span class="st">&quot;date&quot;</span>),</span>
<span id="cb29-13"><a href="working-with-time-series.html#cb29-13"></a>)</span>
<span id="cb29-14"><a href="working-with-time-series.html#cb29-14"></a><span class="co"># a point in the transition forest to pasture in Northern MT</span></span>
<span id="cb29-15"><a href="working-with-time-series.html#cb29-15"></a><span class="co"># obtain a time series from the raster cube for this point</span></span>
<span id="cb29-16"><a href="working-with-time-series.html#cb29-16"></a>series &lt;-<span class="st"> </span><span class="kw">sits_get_data</span>(<span class="dt">cube      =</span> raster_cube,</span>
<span id="cb29-17"><a href="working-with-time-series.html#cb29-17"></a>                        <span class="dt">longitude =</span> <span class="fl">-55.57320</span>, </span>
<span id="cb29-18"><a href="working-with-time-series.html#cb29-18"></a>                        <span class="dt">latitude  =</span> <span class="fl">-11.50566</span>,</span>
<span id="cb29-19"><a href="working-with-time-series.html#cb29-19"></a>                        <span class="dt">bands     =</span> <span class="kw">c</span>(<span class="st">&quot;NDVI&quot;</span>, <span class="st">&quot;EVI&quot;</span>))</span>
<span id="cb29-20"><a href="working-with-time-series.html#cb29-20"></a><span class="kw">plot</span>(series)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-28"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-28-1.png" alt="NDVI and EVI time series fetched from local raster cube." width="70%" />
<p class="caption">
Figure 3.3: NDVI and EVI time series fetched from local raster cube.
</p>
</div>
<p>A useful case is when a set of labelled samples are available to be used as a training data set. In this case, one usually has trusted observations that are labelled and commonly stored in plain text files in comma-separated values (CSV) or using shapefiles (SHP). Function <code>sits_get_data()</code> takes a CSV or SHP file path as an argument. In the case of CSV text file, they should provide, for each training sample, its latitude and longitude, the start and end dates, and a label associated with a ground sample. An example of a CSV file used is shown below.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="working-with-time-series.html#cb30-1"></a><span class="co"># retrieve a list of samples described by a CSV file</span></span>
<span id="cb30-2"><a href="working-with-time-series.html#cb30-2"></a>samples_csv_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/samples/samples_sinop_crop.csv&quot;</span>,</span>
<span id="cb30-3"><a href="working-with-time-series.html#cb30-3"></a>                           <span class="dt">package =</span> <span class="st">&quot;sits&quot;</span>)</span>
<span id="cb30-4"><a href="working-with-time-series.html#cb30-4"></a><span class="co"># for demonstration, read the CSV file into an R object</span></span>
<span id="cb30-5"><a href="working-with-time-series.html#cb30-5"></a>samples_csv &lt;-<span class="st"> </span><span class="kw">read.csv</span>(samples_csv_file)</span>
<span id="cb30-6"><a href="working-with-time-series.html#cb30-6"></a><span class="co"># print the first three lines</span></span>
<span id="cb30-7"><a href="working-with-time-series.html#cb30-7"></a>samples_csv[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre class="sourceCode"><code>#&gt;   id longitude  latitude start_date   end_date   label
#&gt; 1  1 -55.65931 -11.76267 2013-09-14 2014-08-29 Pasture
#&gt; 2  2 -55.64833 -11.76385 2013-09-14 2014-08-29 Pasture
#&gt; 3  3 -55.66738 -11.78032 2013-09-14 2014-08-29  Forest</code></pre>
<p>The main difference between the files used by <em>sits</em> to retrieve training samples from those used traditionally in remote sensing data analysis is that users are expected to provide the temporal information (<code>start_date</code> and <code>end_date</code>). In the simplest case, all samples share the same start and end data. That is not a strict requirement. Users can specify different dates, as long as they have a compatible duration. For example, the data set <code>samples_modis_4bands</code> provided with the sits package contains samples from different years covering the same duration. These samples were obtained from the MOD13Q1 product, which contains the same number of images per year. Thus, all time series in the data set <code>samples_modis_4bands</code> have the same number of instances.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="working-with-time-series.html#cb32-1"></a>samples_modis_4bands[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</span></code></pre></div>
<pre class="sourceCode"><code>#&gt; # A tibble: 5 x 7
#&gt;   longitude latitude start_date end_date   label   cube    time_series      
#&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;list&gt;           
#&gt; 1     -55.2   -10.8  2013-09-14 2014-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 2     -57.8    -9.76 2006-09-14 2007-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 3     -51.9   -13.4  2014-09-14 2015-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 4     -56.0   -10.1  2005-09-14 2006-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;
#&gt; 5     -54.6   -10.4  2013-09-14 2014-08-29 Pasture MOD13Q1 &lt;tibble [23 × 5]&gt;</code></pre>
<p>Given a suitably built sample file, reading the time series in <em>sits</em> is achieved using the <code>sits_get_data</code>. This function has two mandatory parameters for CSV and SHP file; (a) <code>cube</code> which is the name of the R object that describes the data cube; (b) <code>file</code> which is the name of the CSV or SHP file.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="working-with-time-series.html#cb34-1"></a><span class="co"># get the points from a data cube in raster brick format</span></span>
<span id="cb34-2"><a href="working-with-time-series.html#cb34-2"></a>points &lt;-<span class="st"> </span><span class="kw">sits_get_data</span>(<span class="dt">cube =</span> raster_cube, <span class="dt">file =</span> samples_csv_file)</span>
<span id="cb34-3"><a href="working-with-time-series.html#cb34-3"></a><span class="co"># show the tibble with the first three points</span></span>
<span id="cb34-4"><a href="working-with-time-series.html#cb34-4"></a>points[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre class="sourceCode"><code>#&gt; # A tibble: 3 x 7
#&gt;   longitude latitude start_date end_date   label   cube  time_series      
#&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;list&gt;           
#&gt; 1     -55.7    -11.8 2013-09-14 2014-08-29 Pasture Sinop &lt;tibble [23 × 3]&gt;
#&gt; 2     -55.6    -11.8 2013-09-14 2014-08-29 Pasture Sinop &lt;tibble [23 × 3]&gt;
#&gt; 3     -55.7    -11.8 2013-09-14 2014-08-29 Forest  Sinop &lt;tibble [23 × 3]&gt;</code></pre>
<p>Users can also specify samples by providing shapefiles in point or polygon format. In this case, the geographical location is inferred from the geometries associated with the shapefile. For files containing points, the geographical location is obtained directly; for files with polygon, the parameter <code>.n_shp_pol</code> (defaults to 20) determines the number of samples to be extracted from each polygon. The temporal information is inferred from the data cube from which the samples are extracted or can be provided explicitly by the user. The label information is taken from the attribute file associated to the shapefile. The parameter <code>shp_attr</code> indicates the name of the column which contains the label to be associated with each time series.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="working-with-time-series.html#cb36-1"></a><span class="co"># define the input shapefile (consisting of POLYGONS)</span></span>
<span id="cb36-2"><a href="working-with-time-series.html#cb36-2"></a>shp_file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/shapes/agriculture/parcel_agriculture.shp&quot;</span>, </span>
<span id="cb36-3"><a href="working-with-time-series.html#cb36-3"></a>                        <span class="dt">package =</span> <span class="st">&quot;sitsdata&quot;</span>)</span>
<span id="cb36-4"><a href="working-with-time-series.html#cb36-4"></a></span>
<span id="cb36-5"><a href="working-with-time-series.html#cb36-5"></a><span class="co"># set the start and end dates </span></span>
<span id="cb36-6"><a href="working-with-time-series.html#cb36-6"></a>start_date &lt;-<span class="st"> &quot;2013-09-14&quot;</span></span>
<span id="cb36-7"><a href="working-with-time-series.html#cb36-7"></a>end_date   &lt;-<span class="st"> &quot;2014-08-29&quot;</span></span>
<span id="cb36-8"><a href="working-with-time-series.html#cb36-8"></a></span>
<span id="cb36-9"><a href="working-with-time-series.html#cb36-9"></a><span class="co"># define the name of attribute of the shapefile that contains the label</span></span>
<span id="cb36-10"><a href="working-with-time-series.html#cb36-10"></a>shp_attr &lt;-<span class="st"> &quot;ext_na&quot;</span></span>
<span id="cb36-11"><a href="working-with-time-series.html#cb36-11"></a></span>
<span id="cb36-12"><a href="working-with-time-series.html#cb36-12"></a><span class="co"># define the number of samples to extract from each polygon</span></span>
<span id="cb36-13"><a href="working-with-time-series.html#cb36-13"></a>.n_shp_pol &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb36-14"><a href="working-with-time-series.html#cb36-14"></a></span>
<span id="cb36-15"><a href="working-with-time-series.html#cb36-15"></a><span class="co"># read the points in the shapefile and produce a CSV file</span></span>
<span id="cb36-16"><a href="working-with-time-series.html#cb36-16"></a>samples &lt;-<span class="st"> </span><span class="kw">sits_get_data</span>(<span class="dt">cube       =</span> raster_cube, </span>
<span id="cb36-17"><a href="working-with-time-series.html#cb36-17"></a>                         <span class="dt">file       =</span> shp_file, </span>
<span id="cb36-18"><a href="working-with-time-series.html#cb36-18"></a>                         <span class="dt">start_date =</span> start_date, </span>
<span id="cb36-19"><a href="working-with-time-series.html#cb36-19"></a>                         <span class="dt">end_date   =</span> end_date, </span>
<span id="cb36-20"><a href="working-with-time-series.html#cb36-20"></a>                         <span class="dt">shp_attr   =</span> shp_attr, </span>
<span id="cb36-21"><a href="working-with-time-series.html#cb36-21"></a>                         <span class="dt">.n_shp_pol =</span> .n_shp_pol)</span>
<span id="cb36-22"><a href="working-with-time-series.html#cb36-22"></a>samples[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre class="sourceCode"><code>#&gt; # A tibble: 3 x 7
#&gt;   longitude latitude start_date end_date   label cube  time_series      
#&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt; &lt;chr&gt; &lt;list&gt;           
#&gt; 1     -55.6    -11.8 2013-09-14 2014-08-29 &lt;NA&gt;  Sinop &lt;tibble [23 × 3]&gt;
#&gt; 2     -55.6    -11.8 2013-09-14 2014-08-29 &lt;NA&gt;  Sinop &lt;tibble [23 × 3]&gt;
#&gt; 3     -55.6    -11.8 2013-09-14 2014-08-29 &lt;NA&gt;  Sinop &lt;tibble [23 × 3]&gt;</code></pre>
</div>
<div id="filtering-techniques-for-time-series" class="section level2">
<h2><span class="header-section-number">3.5</span> Filtering techniques for time series</h2>
<p>Satellite image time series generally is contaminated by atmospheric influence, geolocation error, and directional effects <span class="citation">(Lambin and Linderman 2006)</span>. Atmospheric noise, sun angle, interferences on observations or different equipment specifications, as well as the very nature of the climate-land dynamics can be sources of variability <span class="citation">(Atkinson et al. 2012)</span>. Inter-annual climate variability also changes the phenological cycles of the vegetation, resulting in time series whose periods and intensities do not match on a year-to-year basis. To make the best use of available satellite data archives, methods for satellite image time series analysis need to deal with <em>noisy</em> and <em>non-homogeneous</em> data sets. In this vignette, we discuss filtering techniques to improve time series data that present missing values or noise.</p>
<p>The literature on satellite image time series has several applications of filtering to correct or smooth vegetation index data. The <code>sits</code> have support for Savitzky–Golay (<code>sits_sgolay()</code>), Whitaker (<code>sits_whittaker()</code>), envelope (<code>sits_envelope()</code>) filters. The first two filters are commonly used in the literature, while the remaining two have been developed by the authors.</p>
<p>Various somewhat conflicting results have been expressed in relation to the time series filtering techniques for phenology applications. For example, in an investigation of phenological parameter estimation, <span class="citation">Atkinson et al. (2012)</span> found that the Whittaker and Fourier transform approaches were preferable to the double logistic and asymmetric Gaussian models. They applied the filters to preprocess MERIS NDVI time series for estimating phenological parameters in India. Comparing the same filters as in the previous work, <span class="citation">Shao et al. (2016)</span> found that only Fourier transform and Whittaker techniques improved interclass separability for crop classes and significantly improved overall classification accuracy. The authors used MODIS NDVI time series from the Great Lakes region in North America. <span class="citation">Zhou et al. (2016)</span> found that the asymmetric Gaussian model outperforms other filters over high latitude boreal biomes, while the Savitzky-Golay model gives the best reconstruction performance in tropical evergreen broadleaf forests. In the remaining biomes, Whittaker gives superior results. The authors compare all previously mentioned filters plus the Savitzky-Golay method for noise removal in MODIS NDVI data from sites spread worldwide in different climatological conditions. Many other techniques can be found in applications of satellite image time series such as curve fitting <span class="citation">(Bradley et al. 2007)</span>, wavelet decomposition <span class="citation">(Sakamoto et al. 2005)</span>, mean-value iteration, ARMD3-ARMA5, and 4253H <span class="citation">(Hird and McDermid 2009)</span>. Therefore, any comparative analysis of smoothing algorithms depends on the adopted performance measurement.</p>
<p>One of the main uses of time series filtering is to reduce the noise and miss data produced by clouds in tropical areas. The following examples use data produced by the PRODES project <span class="citation">(INPE 2019)</span>, which detects deforestation in the Brazilian Amazon rain forest through visual interpretation. This data set is called <code>samples_para_mixl8mod</code> and is provided together with the <strong>sitsdata</strong> package. It has <span class="math inline">\(617\)</span> samples from a region corresponding to the standard Landsat Path/Row 226/064. This is an area in the East of the Brazilian Pará state. It was chosen because of its huge cloud cover from November to March, which is a significant factor in degrading time series quality. Its NDVI and EVI time series were extracted from a combination of MOD13Q1 and Landsat8 images (to best visualize the effects of each filter, we selected only NDVI time series).</p>
<div id="savitzkygolay-filter" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Savitzky–Golay filter</h3>
<p>The Savitzky-Golay filter works by fitting a successive array of <span class="math inline">\(2n+1\)</span> adjacent data points with a <span class="math inline">\(d\)</span>-degree polynomial through linear least squares. The central point <span class="math inline">\(i\)</span> of the window array assumes the value of the interpolated polynomial. An equivalent and much faster solution than this convolution procedure is given by the closed expression
<span class="math display">\[
  {\hat{x}_{i}=\sum _{j=-n}^{n}C_{j}\,x_{i+j}},
\]</span>
where <span class="math inline">\(\hat{x}\)</span> is the the filtered time series, <span class="math inline">\(C_{j}\)</span> are the Savitzky-Golay smoothing coefficients, and <span class="math inline">\(x\)</span> is the original time series.</p>
<p>The coefficients <span class="math inline">\(C_{j}\)</span> depend uniquely on the polynomial degree (<span class="math inline">\(d\)</span>) and the length of the window data points (given by parameter <span class="math inline">\(n\)</span>). If <span class="math inline">\({d=0}\)</span>, the coefficients are constants <span class="math inline">\({C_{j}=1/(2n+1)}\)</span> and the Savitzky-Golay filter will be equivalent to moving average filter. When the time series are equally spaced, the coefficients have an analytical solution. According to <span class="citation">Madden (1978)</span>, for <span class="math inline">\({d\in{}[2,3]}\)</span> each <span class="math inline">\(C_{j}\)</span> smoothing coefficients can be obtained by
<span class="math display">\[
  C_{j}=\frac{3(3n^2+3n-1-5j^2)}{(2n+3)(2n+1)(2n-1)}.
\]</span></p>
<p>In general, the Savitzky-Golay filter produces smoother results for a larger value of <span class="math inline">\(n\)</span> and/or a smaller value of <span class="math inline">\(d\)</span> <span class="citation">(Chen et al. 2004)</span>. The optimal value for these two parameters can vary from case to case. In SITS, the user can set the order of the polynomial using the parameter <code>order</code> (default = 3), the size of the temporal window with the parameter <code>length</code> (default = 5), and the temporal expansion with the parameter <code>scaling</code> (default = 1). The following example shows the effect of Savitsky-Golay filter on a point extracted from the MOD13Q1 product, ranging from 2000-02-18 to 2018-01-01.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="working-with-time-series.html#cb38-1"></a><span class="co"># Take NDVI band of the first sample data set</span></span>
<span id="cb38-2"><a href="working-with-time-series.html#cb38-2"></a>point_ndvi &lt;-<span class="st"> </span><span class="kw">sits_select</span>(point_mt_6bands, <span class="dt">band =</span> <span class="st">&quot;NDVI&quot;</span>)</span>
<span id="cb38-3"><a href="working-with-time-series.html#cb38-3"></a><span class="co"># apply Savitzky–Golay filter</span></span>
<span id="cb38-4"><a href="working-with-time-series.html#cb38-4"></a>point_sg &lt;-<span class="st"> </span><span class="kw">sits_sgolay</span>(point_ndvi, <span class="dt">length =</span> <span class="dv">15</span>)</span>
<span id="cb38-5"><a href="working-with-time-series.html#cb38-5"></a><span class="co"># merge the point and plot the series</span></span>
<span id="cb38-6"><a href="working-with-time-series.html#cb38-6"></a><span class="kw">sits_merge</span>(point_sg, point_ndvi) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-33"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-33-1.png" alt="Savitzky-Golay filter applied on a multi-year NDVI time series." width="70%" />
<p class="caption">
Figure 3.4: Savitzky-Golay filter applied on a multi-year NDVI time series.
</p>
</div>
<p>Notice that the resulting smoothed curve has both desirable and unwanted properties. For the period 2000 to 2008, the Savitsky-Golay filter remove noise resulting from clouds. However, after 2010, when the region has been converted to agriculture, the filter removes an important part of the natural variability from the crop cycle. Therefore, the <code>length</code> parameter is arguably too big and results in oversmoothing. Users can try to reduce this parameter and analyse the results.</p>
</div>
<div id="whittaker-filter" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Whittaker filter</h3>
<p>The Whittaker smoother attempts to fit a curve that represents the raw data, but is penalized if subsequent points vary too much <span class="citation">(Atzberger and Eilers 2011)</span>. The Whittaker filter is a balancing between the residual to the original data and the “smoothness” of the fitted curve. The residual, as measured by the sum of squares of all <span class="math inline">\(n\)</span> time series points deviations, is given by
<span class="math display">\[
  RSS=\sum_{i}(x_{i} - \hat{x_{i}})^2,
\]</span>
where <span class="math inline">\(x\)</span> and <span class="math inline">\(\hat{x}\)</span> are the original and the filtered time series vectors, respectively. The smoothness is assumed to be the measure of the sum of the squares of the third-order differences of the time series <span class="citation">(Whittaker 1922)</span>, which is given by
<span class="math display">\[
  \begin{split}
S\!S\!D = (\hat{x}_4 - 3\hat{x}_3 + 3\hat{x}_2 - \hat{x}_1)^2 + (\hat{x}_5 - 3\hat{x}_4 + 3\hat{x}_3 - \hat{x}_2)^2 \\ + \ldots + (\hat{x}_n - 3\hat{x}_{n-1} + 3\hat{x}_{n-2} - \hat{x}_{n-3})^2.
\end{split}
\]</span></p>
<p>The filter is obtained by finding a new time series <span class="math inline">\(\hat{x}\)</span> whose points minimize the expression
<span class="math display">\[
  RSS+\lambda{}S\!S\!D,
\]</span>
where <span class="math inline">\(\lambda{}\)</span>, a scalar, works as a “smoothing weight” parameter. The minimization can be obtained by differentiating the expression with respect to <span class="math inline">\(\hat{x}\)</span> and equating it to zero. The solution of the resulting linear system of equations gives the filtered time series, which, in matrix form, can be expressed as</p>
<p><span class="math display">\[
  \hat{x} = ({\rm I} + \lambda {D}^{\intercal} D)^{-1}x,
\]</span>
where <span class="math inline">\({\rm I}\)</span> is the identity matrix and
<span class="math display">\[
  D = \left[\begin{array}{ccccccc}
             1 &amp; -3 &amp; 3 &amp; -1 &amp; 0 &amp; 0 &amp;\cdots \\
             0 &amp; 1 &amp; -3 &amp; 3 &amp; -1 &amp; 0 &amp;\cdots \\
             0 &amp; 0 &amp; 1 &amp; -3 &amp; 3 &amp; -1 &amp; \cdots \\
             \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots
             \end{array}
             \right]
\]</span></p>
<p>The following example shows the effect of Whitakker filter on a point extracted from the MOD13Q1 product, ranging from 2000-02-18 to 2018-01-01. The <code>lambda</code> parameter controls the smoothing of the filter. By default, it is set to 0.5, a small value. For illustrative purposes, we show the effect of a larger smoothing parameter</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="working-with-time-series.html#cb39-1"></a><span class="co"># Take NDVI band of the first sample data set</span></span>
<span id="cb39-2"><a href="working-with-time-series.html#cb39-2"></a>point_ndvi &lt;-<span class="st"> </span><span class="kw">sits_select</span>(point_mt_6bands, <span class="dt">band =</span> <span class="st">&quot;NDVI&quot;</span>)</span>
<span id="cb39-3"><a href="working-with-time-series.html#cb39-3"></a><span class="co"># apply Whitakker filter</span></span>
<span id="cb39-4"><a href="working-with-time-series.html#cb39-4"></a>point_whit &lt;-<span class="st"> </span><span class="kw">sits_whittaker</span>(point_ndvi, <span class="dt">lambda =</span> <span class="dv">8</span>)</span>
<span id="cb39-5"><a href="working-with-time-series.html#cb39-5"></a><span class="co"># merge the point and plot the series</span></span>
<span id="cb39-6"><a href="working-with-time-series.html#cb39-6"></a><span class="kw">sits_merge</span>(point_whit, point_ndvi) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-34"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-34-1.png" alt="Whittaker filter applied on a one-year NDVI time series." width="70%" />
<p class="caption">
Figure 3.5: Whittaker filter applied on a one-year NDVI time series.
</p>
</div>
<p>In the same way as what is observed in the Savitsky-Golay filter, high values of the smoothing parameter <code>lambda</code> produce an oversmoothed time series that reduces the capacity of the time series to represent natural variations on crop growth. For this reason, low smoothing values are recommended when using the <code>sits_whittaker</code> function.</p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="earth-observation-data-cubes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-series-clustering-to-improve-the-quality-of-training-samples.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["sitsbook.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
