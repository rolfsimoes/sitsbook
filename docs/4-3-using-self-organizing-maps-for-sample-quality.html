<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4.3 Using Self-organizing Maps for Sample Quality | sits: Data Analysis and Machine Learning for Data Cubes using Satellite Image Time Series" />
<meta property="og:type" content="book" />

<meta property="og:image" content="images/cover.png" />
<meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The output format for this example is bookdown::gitbook.</p>" />



<meta name="date" content="2021-03-30" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The output format for this example is bookdown::gitbook.</p>">

<title>4.3 Using Self-organizing Maps for Sample Quality | sits: Data Analysis and Machine Learning for Data Cubes using Satellite Image Time Series</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#preface">Preface</a></li>
<li class="has-sub"><a href="1-introduction.html#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="1-1-workflow.html#workflow"><span class="toc-section-number">1.1</span> Workflow</a></li>
<li class="has-sub"><a href="1-2-handling-data-cubes-in-sits.html#handling-data-cubes-in-sits"><span class="toc-section-number">1.2</span> Handling Data Cubes in <strong>sits</strong></a><ul>
<li><a href="1-2-handling-data-cubes-in-sits.html#image-data-cubes-as-the-basis-for-big-earth-observation-data-analysis"><span class="toc-section-number">1.2.1</span> Image data cubes as the basis for big Earth observation data analysis</a></li>
<li><a href="1-2-handling-data-cubes-in-sits.html#using-stac-to-access-image-data-cubes"><span class="toc-section-number">1.2.2</span> Using STAC to Access Image Data Cubes</a></li>
<li><a href="1-2-handling-data-cubes-in-sits.html#defining-a-data-cube-using-files"><span class="toc-section-number">1.2.3</span> Defining a data cube using files</a></li>
</ul></li>
<li class="has-sub"><a href="1-3-handling-satellite-image-time-series-in-sits.html#handling-satellite-image-time-series-in-sits"><span class="toc-section-number">1.3</span> Handling satellite image time series in <strong>sits</strong></a><ul>
<li><a href="1-3-handling-satellite-image-time-series-in-sits.html#data-structure"><span class="toc-section-number">1.3.1</span> Data structure</a></li>
<li><a href="1-3-handling-satellite-image-time-series-in-sits.html#obtaining-time-series-data"><span class="toc-section-number">1.3.2</span> Obtaining time series data</a></li>
</ul></li>
<li><a href="1-4-filtering-techniques.html#filtering-techniques"><span class="toc-section-number">1.4</span> Filtering techniques</a></li>
<li><a href="1-5-clustering-for-sample-quality-control-using-self-organizing-maps.html#clustering-for-sample-quality-control-using-self-organizing-maps"><span class="toc-section-number">1.5</span> Clustering for sample quality control using self-organizing maps</a></li>
<li><a href="1-6-classification-using-machine-learning.html#classification-using-machine-learning"><span class="toc-section-number">1.6</span> Classification using machine learning</a></li>
<li><a href="1-7-validation-techniques.html#validation-techniques"><span class="toc-section-number">1.7</span> Validation techniques</a></li>
<li class="has-sub"><a href="1-8-cube-classification.html#cube-classification"><span class="toc-section-number">1.8</span> Cube classification</a><ul>
<li><a href="1-8-cube-classification.html#steps-for-cube-classification"><span class="toc-section-number">1.8.1</span> Steps for cube classification</a></li>
<li><a href="1-8-cube-classification.html#adjustments-for-improved-performance"><span class="toc-section-number">1.8.2</span> Adjustments for improved performance</a></li>
</ul></li>
<li><a href="1-9-smoothing-and-labelling-of-raster-data-after-classification.html#smoothing-and-labelling-of-raster-data-after-classification"><span class="toc-section-number">1.9</span> Smoothing and Labelling of raster data after classification</a></li>
<li><a href="1-10-final-remarks.html#final-remarks"><span class="toc-section-number">1.10</span> Final remarks</a></li>
<li><a href="1-11-acknowledgements.html#acknowledgements"><span class="toc-section-number">1.11</span> Acknowledgements</a></li>
</ul></li>
<li class="has-sub"><a href="2-acessing-time-series-information-in-sits.html#acessing-time-series-information-in-sits"><span class="toc-section-number">2</span> Acessing time series information in SITS</a><ul>
<li><a href="2-1-data-structures-for-satellite-time-series.html#data-structures-for-satellite-time-series"><span class="toc-section-number">2.1</span> Data structures for satellite time series</a></li>
<li><a href="2-2-utilities-for-handling-time-series.html#utilities-for-handling-time-series"><span class="toc-section-number">2.2</span> Utilities for handling time series</a></li>
<li><a href="2-3-time-series-visualisation.html#time-series-visualisation"><span class="toc-section-number">2.3</span> Time series visualisation</a></li>
<li><a href="2-4-obtaining-time-series-data-from-data-cubes.html#obtaining-time-series-data-from-data-cubes"><span class="toc-section-number">2.4</span> Obtaining time series data from data cubes</a></li>
</ul></li>
<li class="has-sub"><a href="3-satellite-image-time-series-filtering-with-sits.html#satellite-image-time-series-filtering-with-sits"><span class="toc-section-number">3</span> Satellite Image Time Series Filtering with SITS</a><ul>
<li><a href="3-1-filtering-techniques-in-sits.html#filtering-techniques-in-sits"><span class="toc-section-number">3.1</span> Filtering techniques in SITS</a></li>
<li class="has-sub"><a href="3-2-common-interface-to-sits-filter-functions.html#common-interface-to-sits-filter-functions"><span class="toc-section-number">3.2</span> Common interface to SITS filter functions</a><ul>
<li><a href="3-2-common-interface-to-sits-filter-functions.html#savitzkygolay-filter"><span class="toc-section-number">3.2.1</span> Savitzky–Golay filter</a></li>
<li><a href="3-2-common-interface-to-sits-filter-functions.html#whittaker-filter"><span class="toc-section-number">3.2.2</span> Whittaker filter</a></li>
<li><a href="3-2-common-interface-to-sits-filter-functions.html#envelope-filter"><span class="toc-section-number">3.2.3</span> Envelope filter</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="4-time-series-clustering-to-improve-the-quality-of-training-samples.html#time-series-clustering-to-improve-the-quality-of-training-samples"><span class="toc-section-number">4</span> Time Series Clustering to Improve the Quality of Training Samples</a><ul>
<li><a href="4-1-clustering-for-sample-quality-control.html#clustering-for-sample-quality-control"><span class="toc-section-number">4.1</span> Clustering for sample quality control</a></li>
<li class="has-sub"><a href="4-2-hierachical-clustering-for-sample-quality-control.html#hierachical-clustering-for-sample-quality-control"><span class="toc-section-number">4.2</span> Hierachical clustering for Sample Quality Control</a><ul>
<li><a href="4-2-hierachical-clustering-for-sample-quality-control.html#creating-a-dendogram"><span class="toc-section-number">4.2.1</span> Creating a dendogram</a></li>
<li><a href="4-2-hierachical-clustering-for-sample-quality-control.html#using-a-dendrogram-to-evaluate-sample-quality"><span class="toc-section-number">4.2.2</span> Using a dendrogram to evaluate sample quality</a></li>
</ul></li>
<li class="has-sub"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#using-self-organizing-maps-for-sample-quality"><span class="toc-section-number">4.3</span> Using Self-organizing Maps for Sample Quality</a><ul>
<li><a href="4-3-using-self-organizing-maps-for-sample-quality.html#introduction-to-self-organizing-maps"><span class="toc-section-number">4.3.1</span> Introduction to Self-organizing Maps</a></li>
<li><a href="4-3-using-self-organizing-maps-for-sample-quality.html#using-som-for-removing-class-noise"><span class="toc-section-number">4.3.2</span> Using SOM for removing class noise</a></li>
<li><a href="4-3-using-self-organizing-maps-for-sample-quality.html#comparing-global-accuracy-of-original-and-clean-samples"><span class="toc-section-number">4.3.3</span> Comparing Global Accuracy of Original and Clean Samples</a></li>
</ul></li>
<li><a href="4-4-conclusion.html#conclusion"><span class="toc-section-number">4.4</span> Conclusion</a></li>
</ul></li>
<li class="has-sub"><a href="5-machine-learning-for-data-cubes-using-the-sits-package.html#machine-learning-for-data-cubes-using-the-sits-package"><span class="toc-section-number">5</span> Machine Learning for Data Cubes using the SITS package</a><ul>
<li><a href="5-1-machine-learning-classification.html#machine-learning-classification"><span class="toc-section-number">5.1</span> Machine learning classification</a></li>
<li><a href="5-2-data-used-in-the-machine-learning-examples.html#data-used-in-the-machine-learning-examples"><span class="toc-section-number">5.2</span> Data used in the machine learning examples</a></li>
<li><a href="5-3-visualizing-samples.html#visualizing-samples"><span class="toc-section-number">5.3</span> Visualizing Samples</a></li>
<li><a href="5-4-common-interface-to-machine-learning-and-deeplearning-models.html#common-interface-to-machine-learning-and-deeplearning-models"><span class="toc-section-number">5.4</span> Common interface to machine learning and deeplearning models</a></li>
<li><a href="5-5-random-forests.html#random-forests"><span class="toc-section-number">5.5</span> Random forests</a></li>
<li><a href="5-6-support-vector-machines.html#support-vector-machines"><span class="toc-section-number">5.6</span> Support Vector Machines</a></li>
<li><a href="5-7-extreme-gradient-boosting.html#extreme-gradient-boosting"><span class="toc-section-number">5.7</span> Extreme Gradient Boosting</a></li>
<li><a href="5-8-deep-learning-using-multi-layer-perceptrons.html#deep-learning-using-multi-layer-perceptrons"><span class="toc-section-number">5.8</span> Deep learning using multi-layer perceptrons</a></li>
<li><a href="5-9-d-convolutional-neural-networks.html#d-convolutional-neural-networks"><span class="toc-section-number">5.9</span> 1D Convolutional Neural Networks</a></li>
<li><a href="5-10-residual-1d-cnn-networks-resnet.html#residual-1d-cnn-networks-resnet"><span class="toc-section-number">5.10</span> Residual 1D CNN Networks (ResNet)</a></li>
</ul></li>
<li class="has-sub"><a href="6-classification-of-images-in-data-cubes-using-satellite-image-time-series.html#classification-of-images-in-data-cubes-using-satellite-image-time-series"><span class="toc-section-number">6</span> Classification of Images in Data Cubes using Satellite Image Time Series</a><ul>
<li><a href="6-1-image-data-cubes-as-the-basis-for-big-earth-observation-data-analysis-1.html#image-data-cubes-as-the-basis-for-big-earth-observation-data-analysis-1"><span class="toc-section-number">6.1</span> Image data cubes as the basis for big Earth observation data analysis</a></li>
<li><a href="6-2-defining-a-data-cube-using-files-organised-as-raster-bricks.html#defining-a-data-cube-using-files-organised-as-raster-bricks"><span class="toc-section-number">6.2</span> Defining a data cube using files organised as raster bricks</a></li>
<li><a href="6-3-classification-using-machine-learning-1.html#classification-using-machine-learning-1"><span class="toc-section-number">6.3</span> Classification using machine learning</a></li>
<li class="has-sub"><a href="6-4-cube-classification-1.html#cube-classification-1"><span class="toc-section-number">6.4</span> Cube classification</a><ul>
<li><a href="6-4-cube-classification-1.html#steps-for-cube-classification-1"><span class="toc-section-number">6.4.1</span> Steps for cube classification</a></li>
<li><a href="6-4-cube-classification-1.html#adjustments-for-improved-performance-1"><span class="toc-section-number">6.4.2</span> Adjustments for improved performance</a></li>
</ul></li>
<li><a href="6-5-final-remarks-1.html#final-remarks-1"><span class="toc-section-number">6.5</span> Final remarks</a></li>
</ul></li>
<li class="has-sub"><a href="7-post-classification-smoothing-using-bayesian-techniques-in-sits.html#post-classification-smoothing-using-bayesian-techniques-in-sits"><span class="toc-section-number">7</span> Post classification smoothing using Bayesian techniques in SITS</a><ul>
<li><a href="7-1-introduction-1.html#introduction-1"><span class="toc-section-number">7.1</span> Introduction</a></li>
<li class="has-sub"><a href="7-2-overview-of-bayesian-estimattion.html#overview-of-bayesian-estimattion"><span class="toc-section-number">7.2</span> Overview of Bayesian estimattion</a><ul>
<li><a href="7-2-overview-of-bayesian-estimattion.html#smmothing-using-bayes-rule"><span class="toc-section-number">7.2.1</span> Smmothing using Bayes’ rule</a></li>
</ul></li>
<li><a href="7-3-use-of-bayesian-smoothing-in-sits.html#use-of-bayesian-smoothing-in-sits"><span class="toc-section-number">7.3</span> Use of Bayesian smoothing in SITS</a></li>
</ul></li>
<li class="has-sub"><a href="8-validation-and-accuracy-measurements-in-sits.html#validation-and-accuracy-measurements-in-sits"><span class="toc-section-number">8</span> Validation and accuracy measurements in SITS</a><ul>
<li><a href="8-1-validation-techniques-1.html#validation-techniques-1"><span class="toc-section-number">8.1</span> Validation techniques</a></li>
<li><a href="8-2-comparing-different-validation-methods.html#comparing-different-validation-methods"><span class="toc-section-number">8.2</span> Comparing different validation methods</a></li>
</ul></li>
<li><a href="references.html#references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="using-self-organizing-maps-for-sample-quality" class="section level2">
<h2><span class="header-section-number">4.3</span> Using Self-organizing Maps for Sample Quality</h2>
<div id="introduction-to-self-organizing-maps" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Introduction to Self-organizing Maps</h3>
<p>As an alternative for hierachical clustering for quality control of training samples, SITS provides a clustering technique based on self-organizing maps (SOM). SOM is a dimensionality reduction technique <span class="citation">(<span class="citeproc-not-found" data-reference-id="Kohonen1990"><strong>???</strong></span>)</span>, where high-dimensional data is mapped into two dimensions, keeping the topological relations between data patterns. The input data is a set of tranining samples which are typically of a high dimension. For example, a time series of 25 instances of 4 spectral bands is a 100-dimensional data set. The general idea of SOM-based clustering is that, by projecting the high-dimensional data set of training samples into a 2D map, the units of the map (called “neurons”) compete for each sample. It is expected that good quality samples of each class should be close together in the resulting map. The neighbors of each neuron of a SOM map provide information on intra-class and inter-class variability.</p>
<p>The main steps of our proposed method for quality assessment of satellite image time series is shown in the figure below. The method uses self-organizing maps (SOM) to perform dimensionality reduction while preserving the topology of original datasets. Since SOM preserves the topological structure of neighborhoods in multiple dimensions, the resulting 2D map can be used as a set of clusters. Training samples that belong to the same class will usually be neighbors in 2D space. The neighbors of each neuron of a SOM map are also expected to be similar.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-31"></span>
<img src="images/methodology_bayes_som.png" alt="Using SOM for class noise reduction" width="90%" height="90%" />
<p class="caption">
Figure 4.1: Using SOM for class noise reduction
</p>
</div>
<p>As the figure shows, a SOM grid is composed by units called . The algorithm computes the distances of each member of the training set to all neurons and finds the neuron closest to the input, called the best matching unit (BMU). The weights of the BMU and its neighbors are updated so as to preserve their similarity [Kohonen2013]. This mapping and adjustment procedures is done in several iterations. At each step, the extent of the change in the neurons diminishes, until a convergence threshold is reached. The result is a 2D mapping of the training set, where similar elements of the input are mapped to the same neuron or to nearby ones. The resulting SOM grid combines dimensionality reduction with topological preservation.</p>
</div>
<div id="using-som-for-removing-class-noise" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Using SOM for removing class noise</h3>
<p>The process of clustering with SOM is done by <code>sits_som_map()</code> which creates a self-organizing map and assesses the quality of the samples. The function has two parts. First, it computes a SOM grid, as discussed previously, where each sample is assigned to neuron, and neurons are placed in the grid based on similarity. The second step is the quality assessment. Each neuron will be associated to a discrete probability distribution. Homogeneous neurons (those with a single class) are assumed to be composed of good quality samples. Heterogeneous neurons (those with two or more classes with significant probability) are likely to contain noisy samples.</p>
<p>Considering that each sample of the training set is assigned to a neuron, the algorithm computes two values for each sample:</p>
<ul>
<li>prior probability: the probability that the label assigned to the sample is correct, considering only the samples in the same neuron. For example, if a neuron has 20 samples, of which 15 are labeled as “Pasture” and 5 as “Forest”, all samples labeled “Forest” are assigned a prior probability of 25%. This is an indication that the “Forest” samples in this neuron are not of good quality.</li>
<li>posterior probability: the probability that the label assigned to the sample is correct, considering the neighboring neurons. Take the case of the above-mentioned neuron whose samples labeled “Pasture” have a prior probability of 75%. What happens if all the neighboring samples have “Forest” as a majority label? Are the samples labeled “Pasture” in this neuron noisy? To answer this question, we use information from the neighbours. Bayesian inference we estimate if these samples are noisy based on the samples of the neighboring neurons [Santos2021].</li>
</ul>
<p>As an example of the use of SOM clustering for quality control of samples, we take a dataset containing a tibble with time series samples for the Cerrado region of Brazil, the second largest biome in South America with an area of more than 2 million km2. The training samples were collected by ground surveys and high-resolution image interpretation by experts from the Brazilian National Institute for Space Research (INPE) team and partners. This set ranges from 2000 to 2017 and includes 61,073 land use and cover samples divided into 14 classes: Natural Non-vegetated, Fallow-Cotton, Millet-Cotton, Soy-Corn, Soy-Cotton, Soy-Fallow, Pasture, Shrublands (in Portuguese ), Savanna (in Portuguese , Dense Tree Savanna (in Portuguese ), Open Savanna (in Portuguese ), Planted Forest, and (14) Wetlands. In the example below, we take only 10% of the samples
for faster processing. Users are encouraged to run the example with the full
set of samples.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-1"></a><span class="co"># take only 10% of the samples</span></span>
<span id="cb54-2"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-2"></a>samples_cerrado_mod13q1_reduced &lt;-<span class="st"> </span><span class="kw">sits_sample</span>(samples_cerrado_mod13q1, <span class="dt">frac =</span> <span class="fl">0.1</span>)</span>
<span id="cb54-3"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-3"></a><span class="co"># clustering time series using SOM</span></span>
<span id="cb54-4"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-4"></a>som_cluster &lt;-</span>
<span id="cb54-5"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-5"></a><span class="st">    </span><span class="kw">sits_som_map</span>(</span>
<span id="cb54-6"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-6"></a>        samples_cerrado_mod13q1_reduced,</span>
<span id="cb54-7"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-7"></a>        <span class="dt">grid_xdim =</span> <span class="dv">15</span>,</span>
<span id="cb54-8"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-8"></a>        <span class="dt">grid_ydim =</span> <span class="dv">15</span>,</span>
<span id="cb54-9"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-9"></a>        <span class="dt">alpha =</span> <span class="fl">1.0</span>,</span>
<span id="cb54-10"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-10"></a>        <span class="dt">distance =</span> <span class="st">&quot;euclidean&quot;</span>,</span>
<span id="cb54-11"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-11"></a>        <span class="dt">rlen =</span> <span class="dv">100</span></span>
<span id="cb54-12"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb54-12"></a>    )</span></code></pre></div>
<p>The output of the <code>sits_som_map</code> is a list with 4 tibbles:</p>
<ul>
<li><p>the original set of time series with two additional columns for each time series: <code>id_sample</code> (the original id of each sample) and <code>id_neuron</code> (the id of the neuron to which it belongs).</p></li>
<li><p>a tibble with information on the neuron. For each neuron, it gives the prior and posterior probabilities of all labels which occur in the samples assigned to it.</p></li>
<li><p>the SOM grid
To plot the SOM grid, use <code>plot()</code>. The neurons are labelled using the majority voting.</p></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb55-1"></a><span class="kw">plot</span>(som_cluster)</span></code></pre></div>
<p><img src="sitsbook_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Looking at the SOM grid, one can see that most of the neurons of a class are located close to each other. There are outliers, e.g, some “Open Savanna” neurons are located amidst “Shrublands” neurons. This mixture is a consequence of the continuous nature of natural vegetation cover in the Brazilian Cerrado. The transition between areas of open savanna and shrublands is not always well defined; moreover, it is dependent on factors such as climate and latitude.</p>
<p>To identifies noisy samples, we take the result of the <code>sits_som_map</code> function as the first argument to the function <code>sits_som_clean_samples</code>. This function finds out which samples are noisy, those that are clean, and some that need to be further examined by the user. It uses the <code>prior_threshold</code> and <code>posterior_threshold</code> parameters according to the following rules:</p>
<ul>
<li>If the prior probability of a sample is less than <code>prior_threshold</code>, the sample is assumed to be noisy and tagged as “remove”;</li>
<li>If the prior probability is greater or equal to <code>prior_threshold</code> and the posterior probability is greater or equal to <code>posterior_threshold</code>, the sample is assumed not to be noisy and thus is tagged as “clean”;</li>
<li>If the prior probability is greater or equal to <code>prior_threshold</code> and the posterior probability is less than <code>posterior_threshold</code>, we have a situation the sample is part of the majority lavel of those assigned to its neuron, but its label is not consistent with most of its neighbors. This is an anomalous condition and is tagged as “analyze”. Users are encouraged to inspect
such samples to find out whether they are in fact noisy or not.</li>
</ul>
<p>The default value for both <code>prior_threshold</code> and <code>posterior_threshold</code> is 60%. The <code>sits_som_clean_samples</code> has an additional parameter (<code>keep</code>) which indicates which samples should be kept in the set based on their prior and posterior probabilities of being noisy and the assigned label. The default value for <code>keep</code> is <code>c("clean", "analyze")</code>. As a result of the cleaning, about 900 samples have been considered to be noisy and thus removed.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-1"></a>new_samples &lt;-<span class="st"> </span><span class="kw">sits_som_clean_samples</span>(som_cluster, </span>
<span id="cb56-2"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-2"></a>                                      <span class="dt">prior_threshold =</span> <span class="fl">0.6</span>,</span>
<span id="cb56-3"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-3"></a>                                      <span class="dt">posterior_threshold =</span> <span class="fl">0.6</span>,</span>
<span id="cb56-4"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-4"></a>                                      <span class="dt">keep =</span> <span class="kw">c</span>(<span class="st">&quot;clean&quot;</span>, <span class="st">&quot;analyze&quot;</span>))</span>
<span id="cb56-5"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-5"></a><span class="co"># find out how many samples are evaluated as &quot;clean&quot; or &quot;analyze&quot;</span></span>
<span id="cb56-6"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-6"></a>new_samples <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-7"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(eval) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-8"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb56-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">count =</span> dplyr<span class="op">::</span><span class="kw">n</span>(), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 2
#&gt;   eval    count
#&gt;   &lt;chr&gt;   &lt;int&gt;
#&gt; 1 analyze   784
#&gt; 2 clean    4432</code></pre>
</div>
<div id="comparing-global-accuracy-of-original-and-clean-samples" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Comparing Global Accuracy of Original and Clean Samples</h3>
<p>To compare the accuracy of the original and clean samples, we run
a 5-fold validation on the original and on the cleaned sample.we use the function
<code>sits_kfold_validate</code>. As the results show, the SOM procedure is useful, since
the global accuracy improves from 91% to 95%.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb58-1"></a>assess_orig &lt;-<span class="st"> </span><span class="kw">sits_kfold_validate</span>(samples_cerrado_mod13q1_reduced, </span>
<span id="cb58-2"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb58-2"></a>                                   <span class="dt">ml_method =</span> <span class="kw">sits_svm</span>())</span></code></pre></div>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;                     Reference
#&gt; Prediction           Dense_Tree_Savanna Fallow_Cotton Millet_Cotton
#&gt;   Dense_Tree_Savanna               1109             0             0
#&gt;   Fallow_Cotton                       0            45             4
#&gt;   Millet_Cotton                       0             1            23
#&gt;   NatNonVegetated                     0             0             0
#&gt;   Open_Savanna                        1             3             0
#&gt;   Pasture                             2             5             0
#&gt;   Planted Forest                      3             0             0
#&gt;   Savanna                            45             0             0
#&gt;   Shrublands                          0             0             0
#&gt;   Soy_Corn                            0             3             0
#&gt;   Soy_Cotton                          0             6             5
#&gt;   Soy_Fallow                          0             0             0
#&gt;   Wetlands                            6             0             0
#&gt;                     Reference
#&gt; Prediction           NatNonVegetated Open_Savanna Pasture Planted Forest
#&gt;   Dense_Tree_Savanna               0            1       3             15
#&gt;   Fallow_Cotton                    0            0       1              0
#&gt;   Millet_Cotton                    0            0       0              0
#&gt;   NatNonVegetated                 50            0       0              0
#&gt;   Open_Savanna                     0         1077      40              0
#&gt;   Pasture                          0           21     477              0
#&gt;   Planted Forest                   0            0       1             26
#&gt;   Savanna                          0           34       6              1
#&gt;   Shrublands                       0           26       0              0
#&gt;   Soy_Corn                         0            1       3              0
#&gt;   Soy_Cotton                       0            0       0              0
#&gt;   Soy_Fallow                       0            2       2              0
#&gt;   Wetlands                         5           37       0              0
#&gt;                     Reference
#&gt; Prediction           Savanna Shrublands Soy_Corn Soy_Cotton Soy_Fallow Wetlands
#&gt;   Dense_Tree_Savanna      32          1        1          1          3        0
#&gt;   Fallow_Cotton            0          0        2          3          0        0
#&gt;   Millet_Cotton            0          0        0          3          0        0
#&gt;   NatNonVegetated          0          0        0          0          0        0
#&gt;   Open_Savanna            37         40        2          1          2       14
#&gt;   Pasture                  8          0        6          1          3        0
#&gt;   Planted Forest           0          0        0          0          0        0
#&gt;   Savanna                818          3        1          0          0        2
#&gt;   Shrublands               3        643        0          0          0        3
#&gt;   Soy_Corn                 0          0      531          8          1        0
#&gt;   Soy_Cotton               0          0       10        395          0        0
#&gt;   Soy_Fallow               0          0        3          0        159        0
#&gt;   Wetlands                19          5        0          0          3      251
#&gt; 
#&gt; Overall Statistics
#&gt;                             
#&gt;  Accuracy : 0.9175          
#&gt;    95% CI : (0.9103, 0.9243)
#&gt;                             
#&gt;     Kappa : 0.9047          
#&gt; 
#&gt; Statistics by Class:
#&gt; 
#&gt;                           Class: Dense_Tree_Savanna Class: Fallow_Cotton
#&gt; Prod Acc (Sensitivity)                       0.9511               0.7143
#&gt; Specificity                                  0.9885               0.9983
#&gt; User Acc (Pos Pred Value)                    0.9511               0.8182
#&gt; Neg Pred Value                               0.9885               0.9970
#&gt;                           Class: Millet_Cotton Class: NatNonVegetated
#&gt; Prod Acc (Sensitivity)                  0.7188                 0.9091
#&gt; Specificity                             0.9993                 1.0000
#&gt; User Acc (Pos Pred Value)               0.8519                 1.0000
#&gt; Neg Pred Value                          0.9985                 0.9992
#&gt;                           Class: Open_Savanna Class: Pasture
#&gt; Prod Acc (Sensitivity)                 0.8982         0.8949
#&gt; Specificity                            0.9715         0.9917
#&gt; User Acc (Pos Pred Value)              0.8850         0.9120
#&gt; Neg Pred Value                         0.9751         0.9900
#&gt;                           Class: Planted Forest Class: Savanna
#&gt; Prod Acc (Sensitivity)                   0.6190         0.8920
#&gt; Specificity                              0.9993         0.9823
#&gt; User Acc (Pos Pred Value)                0.8667         0.8989
#&gt; Neg Pred Value                           0.9974         0.9810
#&gt;                           Class: Shrublands Class: Soy_Corn Class: Soy_Cotton
#&gt; Prod Acc (Sensitivity)               0.9292          0.9550            0.9587
#&gt; Specificity                          0.9941          0.9971            0.9963
#&gt; User Acc (Pos Pred Value)            0.9526          0.9707            0.9495
#&gt; Neg Pred Value                       0.9910          0.9955            0.9970
#&gt;                           Class: Soy_Fallow Class: Wetlands
#&gt; Prod Acc (Sensitivity)               0.9298          0.9296
#&gt; Specificity                          0.9988          0.9872
#&gt; User Acc (Pos Pred Value)            0.9578          0.7699
#&gt; Neg Pred Value                       0.9980          0.9967</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb60-1"></a>assess_new &lt;-<span class="st"> </span><span class="kw">sits_kfold_validate</span>(new_samples, </span>
<span id="cb60-2"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb60-2"></a>                                   <span class="dt">ml_method =</span> <span class="kw">sits_svm</span>())</span></code></pre></div>
<pre><code>#&gt; Confusion Matrix and Statistics
#&gt; 
#&gt;                     Reference
#&gt; Prediction           Dense_Tree_Savanna Fallow_Cotton NatNonVegetated
#&gt;   Dense_Tree_Savanna               1063             0               0
#&gt;   Fallow_Cotton                       0            24               0
#&gt;   NatNonVegetated                     0             0              50
#&gt;   Open_Savanna                        1             1               0
#&gt;   Pasture                             2             1               0
#&gt;   Planted Forest                      2             0               0
#&gt;   Savanna                            19             0               0
#&gt;   Shrublands                          0             0               0
#&gt;   Soy_Corn                            0             5               0
#&gt;   Soy_Cotton                          0             3               0
#&gt;   Soy_Fallow                          0             0               0
#&gt;   Wetlands                            7             0               5
#&gt;                     Reference
#&gt; Prediction           Open_Savanna Pasture Planted Forest Savanna Shrublands
#&gt;   Dense_Tree_Savanna            2       4              6      15          0
#&gt;   Fallow_Cotton                 1       0              0       0          0
#&gt;   NatNonVegetated               0       0              0       0          0
#&gt;   Open_Savanna                879      26              0      19         12
#&gt;   Pasture                       9     415              0       3          0
#&gt;   Planted Forest                0       0              8       0          0
#&gt;   Savanna                      22       3              0     730          0
#&gt;   Shrublands                   14       0              0       0        540
#&gt;   Soy_Corn                      0       2              0       0          0
#&gt;   Soy_Cotton                    0       0              0       0          0
#&gt;   Soy_Fallow                    1       1              0       0          0
#&gt;   Wetlands                      9       0              0      14          6
#&gt;                     Reference
#&gt; Prediction           Soy_Corn Soy_Cotton Soy_Fallow Wetlands
#&gt;   Dense_Tree_Savanna        1          2          0        0
#&gt;   Fallow_Cotton             0          0          0        0
#&gt;   NatNonVegetated           0          0          0        0
#&gt;   Open_Savanna              2          0          0        2
#&gt;   Pasture                   4          1          5        0
#&gt;   Planted Forest            0          0          0        0
#&gt;   Savanna                   1          0          0        0
#&gt;   Shrublands                0          0          0        1
#&gt;   Soy_Corn                515          3          2        0
#&gt;   Soy_Cotton                0        359          0        0
#&gt;   Soy_Fallow                2          0        150        0
#&gt;   Wetlands                  0          0          7      235
#&gt; 
#&gt; Overall Statistics
#&gt;                             
#&gt;  Accuracy : 0.9525          
#&gt;    95% CI : (0.9463, 0.9581)
#&gt;                             
#&gt;     Kappa : 0.945           
#&gt; 
#&gt; Statistics by Class:
#&gt; 
#&gt;                           Class: Dense_Tree_Savanna Class: Fallow_Cotton
#&gt; Prod Acc (Sensitivity)                       0.9717               0.7059
#&gt; Specificity                                  0.9927               0.9998
#&gt; User Acc (Pos Pred Value)                    0.9726               0.9600
#&gt; Neg Pred Value                               0.9925               0.9981
#&gt;                           Class: NatNonVegetated Class: Open_Savanna
#&gt; Prod Acc (Sensitivity)                    0.9091              0.9381
#&gt; Specificity                               1.0000              0.9853
#&gt; User Acc (Pos Pred Value)                 1.0000              0.9331
#&gt; Neg Pred Value                            0.9990              0.9864
#&gt;                           Class: Pasture Class: Planted Forest Class: Savanna
#&gt; Prod Acc (Sensitivity)            0.9202                0.5714         0.9347
#&gt; Specificity                       0.9948                0.9996         0.9899
#&gt; User Acc (Pos Pred Value)         0.9432                0.8000         0.9419
#&gt; Neg Pred Value                    0.9925                0.9988         0.9885
#&gt;                           Class: Shrublands Class: Soy_Corn Class: Soy_Cotton
#&gt; Prod Acc (Sensitivity)               0.9677          0.9810            0.9836
#&gt; Specificity                          0.9968          0.9974            0.9994
#&gt; User Acc (Pos Pred Value)            0.9730          0.9772            0.9917
#&gt; Neg Pred Value                       0.9961          0.9979            0.9988
#&gt;                           Class: Soy_Fallow Class: Wetlands
#&gt; Prod Acc (Sensitivity)               0.9146          0.9874
#&gt; Specificity                          0.9992          0.9904
#&gt; User Acc (Pos Pred Value)            0.9740          0.8304
#&gt; Neg Pred Value                       0.9972          0.9994</code></pre>
<p>An additional way of evaluate the quality of samples is to examine the internal
mixture inside neurons with the same label. We call a group of neurons sharing
the same label as a “cluster”. Given a SOM map, the function <code>sits_som_evaluate_cluster</code>
examines all clusters to find out the percentage of samples contained in it
which do not share it label. This information is saved as a tibble and can also
be visualized.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb62-1"></a><span class="co"># evaluate the misture in the SOM clusters</span></span>
<span id="cb62-2"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb62-2"></a>cluster_mixture &lt;-<span class="st"> </span><span class="kw">sits_som_evaluate_cluster</span>(som_cluster)</span>
<span id="cb62-3"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb62-3"></a><span class="co"># plot the mixture information.</span></span>
<span id="cb62-4"><a href="4-3-using-self-organizing-maps-for-sample-quality.html#cb62-4"></a><span class="kw">plot</span>(cluster_mixture)</span></code></pre></div>
<p><img src="sitsbook_files/figure-html/unnamed-chunk-37-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<p style="text-align: center;">
<a href="4-2-hierachical-clustering-for-sample-quality-control.html"><button class="btn btn-default">Previous</button></a>
<a href="4-4-conclusion.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
